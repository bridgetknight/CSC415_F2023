<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet">
    <title>Quick Benchmark</title>
    <link rel="stylesheet" href="style.css">

    <script>
        const output = document.getElementById("output_box");
    </script>
    <!--<link rel="icon" href="">-->
</head>

<header id="header">
    <div id="name">
        <div class="link_float">quickMark</div>                 
    </div>
    <div id="subtitle"><span>&#x2022; Created by Bridget Knight</span></div>
    <!--<img id="logo" src="assets/portrait.png">-->
</header>

<body>
    <div id="center">
        <div id="blurb">
            quickMark takes your Python code snippets and provides you with performance stats including 
            the time and memory statistics. Simply enter your code in the editor and click run to see your
            results below!
        </div>
        <span class="title output">Output</span>
        <p id="output"></p>
        <div id="editor_box">
            <span class="title editor">Editor</span>
            <div id="editor"></div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/ace.js" type="text/javascript" charset="utf-8"></script>
            <script>
                var editor = ace.edit("editor");
                editor.setTheme("ace/theme/ambiance");
                editor.getSession().setMode("ace/mode/python");

                function executePython() {
                    // get code from user input
                    const code = editor.getValue();
                    console.log(">>>",code);

                    // timing
                    const startTime = Date.now();
                    var endTime;

                    // wrap code in a function with timing calculation
                    const wrappedCode = `(function() { ${code}
                        const endTime = Date.now();
                        document.getElementById("output").innerText +=
                        "Execution time: ${(endTime - startTime)/1000} seconds";
                    })();`;

                    // run code using PyScript
                    out = pyscript.eval(wrappedCode);
                    console.log(out);
                }

                /*async function executePython() {
                    // get code from user input
                    const code = editor.getValue();
                    console.log(">>>",code);
                    const wrappedCode =  `def test(): 
                        ${code}`;
                    // timing
                    const startTime = Date.now();
                    var endTime; 
                    
                    const pyodideRuntime = await loadPyodide();
                    pyodideRuntime.runPython(code);

                    let val = pyodideRuntime.globals.get("test");
                    console.log(val);
                }*/
            </script>
            <button id="run">&#9654;</button>
            <script>
                /*const runButton = document.getElementById("run");
                const codeInput = editor.getValue();
                const outputElement = document.getElementById("output");

                runButton.addEventListener("click", async () => {
                    // timing
                    const startTime = Date.now();

                    // send code to PythonRun using fetch API
                    const response = await fetch("https://api.pythonrun.io/v1/run", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            code: codeInput,
                            input: "" // optional input
                        }),
                    })
                    //const data = await response.json();
                });

                response.json().then(data => {
                    console.log(response);
                    //const data = response.json();
                    const outputText = `${data.output}`;
                    const endTime = Date.now();
                    const elapsedTime = endTime - startTime;
                    const timingResult = "Execution time: ${elapsedTime} ms";
                    outputElement.textContent = data.error ? `Error: ${data.error}` : outputText + timingText;
                }).catch(error => {
                    outputElement.textContent = `Error: ${error.message}`;  
                });*/
            </script>
        </div>
    </div>       
</body>
</html>
